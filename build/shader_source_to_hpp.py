import os

sources_path = "../src/shaders/"
headers_path = "../include/shadersSources.hpp"

header = open(headers_path, "w")
header.write("// Automatically generated by a build script")

def remove_single_line_comment_and_strip(line):
    index = line.find("//")
    if index == -1:
        return line.strip()
    return line[:index].strip()

for source_filename in os.listdir(sources_path):
    if source_filename.endswith("vert"):
        type_ = "VERTEX"
    elif source_filename.endswith("frag"):
        type_ = "FRAGMENT"
    else:
        print(f"Ignoring {source_filename}")
        continue
    print(f"Processing {source_filename}")

    name = source_filename.split(".")[0].upper()
    header.write(f"\n\n#define {name}_{type_}_SHADER_SOURCE \"")

    source = open(sources_path + source_filename, "r")

    for line in source:
        line = remove_single_line_comment_and_strip(line)
        if len(line) == 0: continue

        if line[0] == "#":
            header.write(line + "\\n")
            continue

        header.write(line)

    source.close()
    header.write("\"")

header.close()
